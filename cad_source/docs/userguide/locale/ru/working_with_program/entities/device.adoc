
#### Device

Условное графическое обозначение (далее УГО) оборудования на плане или схеме  - это примитив DEVICE (устройство)
в терминах ZCAD. В отличие от стандартного примитива DXF – INSERT (вставка блока) содержит в себе как жестко
определенные в описании блока примитивы, так и динамические, которые можно двигать относительно точки вставки.
Все имена описаний устройств начинаются с приставки DEVICE_, при вставке блока с названием, начинающимся с
DEVICE_, он автоматически будет конвертирован в примитив DEVICE.

Например, чтобы вставить на план дымовой пожарный извещатель, нужно вставить блок DEVICE_PS_DAT_SMOKE. Если вставить просто блок PS_DAT_SMOKE, он не будет конвертирован в примитив DEVICE и останется примитивом DXF – INSERT (вставка блока), не приобретая свойств устройства.
Устройство DEVICE_PS_DAT_SMOKE состоит из 2х блоков:
    • DEVICE_PS_DAT_SMOKE – динамическая часть устройства
    • PS_DAT_SMOKE постоянная часть устройства
Постоянная часть устройства содержит в себе собственно УГО:

Динамическая часть устройства содержит дополнительные примитивы например в данном случае:
    • Обозначение имени устройства
    • контур подрезки присоединенных кабелей
    • коннектор для присоединения кабелей (коннекторов может быть несколько, это самостоятельное устройство).

После вставки устройства, ему необходимо присвоить некоторые параметры. Набор параметров и их названия по умолчанию пока окончательно не определены и могут быть изменены в последующих версиях. Доступ к параметрам устройства можно получить в инспекторе объектов на вкладке Переменные, выбрав мышью соответствующее устройство

(в отладочной версии можно получить полный доступ к модулю переменных объекта кнопкой VM на панели инструментов,

 там можно добавить новые свойства, определить их тип, названия и присвоить значения)

Чтобы выбрать примитив DEVICE, необходимо указать мышью примитив из постоянной, а не из динамической части устройства. Примитивы из динамической части являются самостоятельными и имеют собственные свойства. Для упрощения процедуры выбора в части окна программы есть кнопка 

DWG_EditInSubEntry - модификатор режима выбора, в отжатом состоянии она позволяет выбирать устройства, указывая мышью примитивы из динамической части, но в этом режиме нельзя редактировать динамические примитивы относительно точки вставки. В нажатом состоянии примитивы из динамической части устройства выбираются отдельно, их можно редактировать

Устройство выбрано, в инспекторе объектов доступны свойства.
Шаблон обозначения (строковая переменная Name_Template) – не обязательное свойство, задает шаблон для автоматического формирования обозначения. Вместо вхождений @@[имя переменной] в обозначение вставляются значения соответствующих переменных. В данном случае будут подставлены свойства «Короткое имя» и «Номер» соответственно в результате обозначению будет присвоено «СК4»
Короткое имя (строковая переменная ShortName) –не обезательное свойство, постоянная буквенная часть обозначения
Номер (целочисленная переменная NameNumber) – не обезательное свойство, номер устройства.
Обозначение (строковая переменная Name)  – обязательное свойство, обозначение устройства. В этом примере значение формируется автоматически
В случае наличия у примитива свойства «Шаблон обозначения» - «Обозначение» только для чтения, ручное редактирование не даст результатов программа все равно подставит сформированное значение, если «Шаблон обозначения» отсутствует, можно задать любую строку
Материал (строковая переменная Material) – не обязательное свойство – идентификатор материала который будет добавлен в спецификацию
Таким образом можно отредактировать уже заданные по умолчанию свойства объектов.
Более мощный, но и более сложный способ редактирования свойств устройств – использовать редактор переменных объекта.

Это простой текстовый редактор скриптового pascal-подобного языка.
В секции var описаны переменные-свойства выбранного объекта 
В секции begin…end свойствам присваиваются начальные значения.
Текст скрипта можно редактировать, добавлять-убирать переменные, не забывая что если переменная убрана из секции var, его нужно убрать и из секции begin…end.
Формат описания новых переменных (точка с запятой обязательна):
ИмяПеременной:ТипПеременной;(*'Название свойства'*)
Формат присвоения переменным значений (точка с запятой обязательна):
ИмяПеременной:=ЗначениеПеременной;
Строковые значения необходимо заключать в апострофы

отражения специфических свойств устройства, например номер пожарного извещателя в шлейфе или мощность электроприемника.

Создание своих устройств.
На данном этапе создание пользователем своих блоков-устройств затруднена отсутствием специализированного редактора, но существуют 2 способа:
1. Обратиться к разработчику.
2. Создать новое устройство на базе имеющегося.
Существующие определения устройств находятся в DXF файлах в папке \blocks\el\general\ 
_connector.dxf
-Коннекторы
_el.dxf
-Электротехнические устройства
_KIP.dxf
-Устройства КИПиА
_OPS.dxf
-Устройства пожаро-охранной сигнализации
_nok.dxf
-Устройства для редактора схем. В данный момент не поддерживается

Начальная загрузка этих файлов регулируется конфигурационным файлом \components\autorun.cmd
Cодержимое файла:

;Коментарий
;*-путь к программе
load(*blocks\el\general\_connector.dxf)
load(*blocks\el\general\_el.dxf)
load(*blocks\el\general\_nok.dxf)
load(*blocks\el\general\_OPS.dxf)
load(*blocks\el\general\_KIP.dxf)
;load(*sample\test_dxf\ps.dxf)

Открываем DXF файл с определением нужного устройства в AutoCAD`е, вставляем блоки DEVICE_[УСТРОЙСТВО] и просто [УСТРОЙСТВО] в файл, копируем вставки в новый файл, где редактируем геометрию вставленных блоков.
Не забываем про контур подрезки кабелей, линии его образующие должны находятся на выключеном слое SYS_DEVICE_BORDER в блоке DEVICE_[УСТРОЙСТВО]. Переименовываем вставленные блоки в DEVICE_[НОВОЕУСТРОЙСТВО] и [НОВОЕУСТРОЙСТВО] соответственно, копируем вставки в открытый DXF файл и стираем их, чтобы остались только определения блоков. Сохраняем DXF файл. В файлах определений устройств открытых в AutoCAD`е нельзя выполнять команду _PURGE в автоматическом режиме, только в ручном, удаляя ненужные определения.
Созданное устройство можно вставлять в ZCAD командой Insert(DEVICE_[НОВОЕУСТРОЙСТВО])
Если созданному устройству необходим набор отличных свойств, придется проделать дополнительные шаги:
Отключить (закоментировать) в файле \components\autorun.cmd загрузку файлов, оставить только файл с нужным определением. Например новое определение находится в файле _OPS.dxf, соответственно autorun.cmd должен выглядеть следующим образом:
;Комментарий
;*-путь к программе
;load(*blocks\el\general\_connector.dxf)
;load(*blocks\el\general\_el.dxf)
;load(*blocks\el\general\_nok.dxf)
load(*blocks\el\general\_OPS.dxf)
;load(*blocks\el\general\_KIP.dxf)
;load(*sample\test_dxf\ps.dxf)
Запустить ZCAD и в командной строке ввести команду
ObjVarMan(BD: DEVICE_[НОВОЕУСТРОЙСТВО])
Приставки BD: означает редактирование набора переменных определения блока. В открывшемся редакторе отредактировать набор переменных и их начальные значения. Сохранить _OPS.dxf, закрыть ZCAD, привести \components\autorun.cmd в исходное состояние.